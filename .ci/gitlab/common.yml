.common:
  image: docker.pkg.github.com/clash-lang/clash-compiler/clash-ci-$GHC_VERSION:2021-11-25
  timeout: 2 hours
  stage: build
  retry:
    max: 2
    when:
      - runner_system_failure
      - stuck_or_timeout_failure
  cache:
    key: cabal-store-$CI_JOB_NAME-$GHC_VERSION-v2
    when: always
    paths:
      - /root/.cabal
      - /root/.stack
      - .ci/bindist/linux/debian/*/build
  before_script:
    - export THREADS=$(./.ci/effective_cpus.sh)
    - export CABAL_JOBS=$(./.ci/effective_cpus.sh)
    - export
    - .ci/setup.sh
  tags:
    - local

variables:
  FF_USE_FASTZIP: "true"
  ARTIFACT_COMPRESSION_LEVEL: fastest # We precompress (build) artifacts using zstd
  CACHE_COMPRESSION_LEVEL: fast
  TRANSFER_METER_FREQUENCY: 5s
  GIT_SUBMODULE_STRATEGY: recursive
  TERM: xterm-color
